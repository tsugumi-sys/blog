---
title: "Python multithreading and multiprocessing"
emoji: "ğŸ£"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["python"]
published: true
---

## èƒŒæ™¯

- ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã§å‹•ä½œã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚’ä¸¦åˆ—å‡¦ç†ã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„ã€‚

## multithreading

pythonã§ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚‹å ´åˆã€asyncioã‚’ç”¨ã„ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã§ãã‚‹ã ã‚ã†ã€‚

```py
import asyncio


class AsyncTask:
    async def run(self):
        print("async task!")
        await asyncio.sleep(0.1)


if __name__ == "__main__":
    asyncio.run(AsyncTask().run())
```

## multiprocessing

pythonã§ãƒãƒ«ãƒãƒ—ãƒ­ã‚»ã‚¹ï¼ˆä¸¦åˆ—å‡¦ç†ï¼‰ã‚’å®Ÿè£…ã™ã‚‹å ´åˆã€ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã§ãã‚‹ï¼ˆã„ãã¤ã‹ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚ã‚‹ï¼‰

```py
import os
import sys
from multiprocessing import Pool
from typing import List


class Task:
    def run(self):
        print(f"DummyAsyncTask: Hello from process(id={os.getpid()})")


class ParallelTaskExecuter:
    def __init__(self, num_processes: int):
        self.num_processes = num_processes

    def execute_tasks(self, tasks: List[Task]):
        with Pool(processes=self.num_processes) as process:
            for task in tasks:
                process.apply(task.run)


if __name__ == "__main__":
    executor = ParallelTaskExecuter(2)
    executor.execute_tasks([Task() for _ in range(2)])
```

## multiprorocessing and multithreading

æ¬¡ã«è€ƒãˆã‚‹ã®ãŒã€éåŒæœŸå‡¦ç†ã‚’ä¸¦åˆ—ã«å‡¦ç†ã™ã‚‹ã“ã¨ã ã€‚éåŒæœŸã‚¿ã‚¹ã‚¯ã‚’ä¸¦åˆ—ã«å‡¦ç†ã™ã‚‹å ´åˆã‚’è€ƒãˆã‚‹ã€‚

```py
import asyncio
import os
import sys
from multiprocessing import Pool
from typing import List


class AsyncTask:
    def run(self):
        asyncio.run(self.__run())

    async def __run(self):
        print(f"DummyAsyncTask: Hello from process(id={os.getpid()})")
        await asyncio.sleep(0.1)
        sys.stdout.flush()


class ParallelAsyncTaskExecutor:
    def __init__(self, num_processes: int):
        self.num_processes = num_processes

    def execute_tasks(self, tasks: List[AsyncTask]):
        with Pool(processes=self.num_processes) as process:
            res = [
                process.apply_async(
                    task.run,
                )
                for task in tasks
            ]
            for r in res:
                r.wait()


if __name__ == "__main__":
    execturor = ParallelAsyncTaskExecutor(2)
    execturor.execute_tasks([AsyncTask() for _ in range(2)])
```

å„ãƒ—ãƒ­ã‚»ã‚¹å†…ã§éåŒæœŸå‡¦ç†ã‚’å®Ÿè¡Œã•ã›ã‚‹ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

ã“ã‚Œã«æ°—ã¥ãã®ã«ã‹ãªã‚Šæ™‚é–“ã‚’ä½¿ã£ã¦ã—ã¾ã£ãŸã€‚
